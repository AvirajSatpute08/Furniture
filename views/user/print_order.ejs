<%- include("navbar.ejs")%>

<%if(order_details[0].order_date) { %>
<!-- Start Hero Section -->
<div class="hero">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-5">
                <div class="intro-excerpt">
                    <h1>Product Invoice</h1>
                </div>
            </div>
        </div>
    </div>
    
<div class="container">
    <div class="card">
        <div class="card-header justify-content-center align-items-center">
            <div class="col-md-11">
                Order Date : 
                <strong><%=order_details[0].order_date%></strong>
                <span class="float-end" style="text-transform: capitalize;"> <strong>Status : </strong > <%=order_details[0].order_status%></span>
            </div>
            

        </div>
        <div class="card-body">
            <div class="row mb-4">
                <div class="col-sm-6">
                    <h6 class="mb-3">From:</h6>
                    <div>
                        <strong class="fs-4">A2Z Infotech Pvt ltd</strong>
                    </div>
                    <div>A2Z Infotech pvt Ltd </div>
                    <div>Balikaashtram Ahmednagar </div>
                    <div>Maharashtra 414002</div>
                    <div>Email: info@a2zinfotec.com</div>
                    <div>Phone: +91-8459214468</div>
                </div>

                <div class="col-sm-6">
                    <h6 class="mb-3">To:</h6>
                    <div>
                        <strong class="fs-5"><%=order_details[0].c_fname%>
                            <%=order_details[0].c_lname%></strong>
                    </div>
                    <div><%=order_details[0].c_address%></div>
                    <div><%=order_details[0].c_area%></div>
                    <div><%=order_details[0].c_state +' '+ order_details[0].c_postal_zip%></div>
                    <div>Email : <%=order_details[0].c_email%></div>
                    <div>Phone : +91-<%=order_details[0].c_phone%></div>
                </div>

            </div>

            <div class="table-responsive-sm">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th class="center">#</th>
                            <th>Product Name </th>
                            <th>Product Details </th>

                            <th class="right">Product Price</th>
                            <th class="center">Qty</th>
                            <th class=""> Payment Status </th>
                            <th class="">Transaction Id </th>
                            <th class="right">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% 
                           for(let i=0; i<order_products.length; i++){

                            var subtotal = order_products.reduce((sum, product) => sum + order_products[i].product_price * order_products[i].product_qty, 0);

                            var discount = Number(subtotal * 0.2).toFixed(2);

                            var gst = Number((subtotal - discount) * 0.12).toFixed(2);

                            var total = (subtotal - discount + Number(gst)).toFixed(2);
                            for(var j=0;j<order_details.length; j++){
                            %>

                        <tr>
                            <td class="center"><%= i+1 %></td>
                            <td class="left strong"><%=order_products[i].product_name%></td>
                            <!-- Inside your product details loop -->
                            <td class="left">
                                <span class="product-details">
                                    <%=order_products[i].product_details%>
                                </span>
                                <button class="read-more-btn" onclick="toggleProductDetails(this)">Read More</button>
                            </td><
                            
                            <td class="right">&#8377; <%=order_products[i].product_price%></td>
                            <td class="center"><%=order_products[i].product_qty%></td>
                            <td>
                                <%=order_details[j].payment_status%>
                            </td>
                            <td>
                                <%=order_details[j].transaction_id%>
                            </td>
                            <td class="right">&#8377; <%=subtotal%></td>
                        </tr>

                        <%}}%>
                        
                    </tbody>
                </table>
            </div>
            <div class="row">
                <div class="col-lg-9 col-sm-5">

                </div>
                <div class="col-lg-3 col-sm-5 ml-auto">
                    <table class="table table-clear">
                        <tbody>
                            <tr>
                                <td class="left">
                                    <strong>Subtotal : </strong>
                                </td>
                                <td class="right">&#8377; <%=subtotal%></td>
                            </tr>
                            <tr>
                                <td class="left">
                                    <strong>Discount (20%) : </strong>
                                </td>
                                <td class="right">&#8377; <%=discount%>
                                </td>
                            </tr>
                            <tr>
                                <td class="left">
                                    <strong>GST (12%) : </strong>
                                </td>
                                <td class="right">&#8377; <%=gst%></td>
                            </tr>
                            <tr>
                                <td class="left">
                                    <strong>Total : </strong>
                                </td>
                                <td class="right">
                                    <strong>&#8377; <%=total%></strong>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                </div>

            </div>

        </div>
        <div class="col-md-12">
            <div class="row">
                <button class="btn btn-success btn-outline-danger" onclick="printOrder()">Print Order</button>
            </div>
        </div>
    </div>
</div>
<%}%>
</div>
<!-- End Hero Section -->
<script>
    function printOrder() {
        window.print(); 
    }

    function toggleProductDetails(btn) {
            var details = btn.previousElementSibling; // Get the product details element
            if (details.classList.contains('expanded')) {
                details.classList.remove('expanded'); // Collapse the details
                btn.textContent = 'Read More';
            } else {
                details.classList.add('expanded'); // Expand the details
                btn.textContent = 'Read Less';
            }
        }

</script>
<style>
    @media print {

        
        nav,
        footer {
            display: none;
        }
    }

    .product-details {
        max-height: 100px;
        overflow: hidden; 
        transition: max-height 0.3s ease; /* Add smooth transition effect */
    }

    .product-details.expanded {
        max-height: none; /* Expand to show all content */
    }

</style>
<br><br><br><br>

<%- include("footer.ejs")%>