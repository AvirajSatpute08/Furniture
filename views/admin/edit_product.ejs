<%- include("navbar.ejs") %>

<form action="/admin/update_product" method="post" enctype="multipart/form-data">
    <div class="container-fluid p-3 bg-white">
        <div class="row">
            <div class="mb-3 col-md-12"> 
                <h3>Update Product</h3>
            </div>
            
            <div class="col-md-3 mb-3">
                Select Type:
                <select name="product_type_id" class="form-select">
                    <option selected disabled>Select Type</option>
                    <% for(let i = 0; i < types.length; i++) { %>
                        <option value="<%= types[i]._id %>" 
                            <% if (product_info.product_type_id.equals(types[i]._id)) { %>
                                selected
                            <% } %>
                        >
                            <%= types[i].product_type_name %>
                        </option>
                    <% } %>
                </select>
            </div>

            <div class="mb-3 col-md-3">
                <input type="hidden" name="product_id" value="<%= product_info._id %>">
                Product Name &#9824
                <input type="text" name="product_name" value="<%= product_info.product_name %>" class="form-control">
            </div>
            
            <div class="mb-3 col-md-3">
                Product Price &#8377
                <input type="number" name="product_price" value="<%= product_info.product_price %>" class="form-control">
            </div>
            
            <div class="mb-3 col-md-3">
                Duplicate Price &#8377
                <input type="number" name="duplicate_price" value="<%= product_info.duplicate_price %>" class="form-control">
            </div>
            
            <div class="mb-3 col-md-3">
                Product Image:
                <input type="file" name="product_image" class="form-control" multiple>
            </div>
            
            <div class="mb-3 col-md-3">
                Product Size
                <input type="text" name="product_size" value="<%= product_info.product_size %>" class="form-control">
            </div>
            
            <div class="mb-3 col-md-3">
                Product Color &#10024
                <input type="color" name="product_color" value="<%= product_info.product_color %>" class="form-control">
            </div>
            
            <div class="mb-3 col-md-3">
                Product Labels:
                <input type="text" name="product_label" value="<%= product_info.product_label %>" class="form-control">
            </div>
            
            <div class="mb-3 col-md-12">
                Product Details &#9824
                <textarea name="product_details" class="form-control" rows="5"><%= product_info.product_details %></textarea>
            </div>
            
            <div class="col-md-12 text-center">
                <button class="btn btn-primary" type="submit">Update Product</button>
            </div>

            <% 
            // Ensure product_image is an array and handle accordingly
            const images = product_info.product_image || [];
            for (const image of images) {
                if (image) { 
            %>
                <div class="col-md-3 mb-3 mt-3 text-center">
                    <img src="/uploads/<%= image %>" width="100%">
                    <a href="/admin/delete_product_image/<%= product_info._id %>/<%= image %>">
                        <button class="btn btn-danger p-1 mt-2 ps-3 pe-3" type="button">
                            Delete
                        </button>
                    </a>
                </div>
            <% } } %>

        </div>
    </div>
</form>

<%- include("footer.ejs") %>
